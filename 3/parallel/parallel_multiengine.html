<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>IPython’s Direct interface &mdash; IPython 3.2.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.2.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="IPython 3.2.1 documentation" href="../index.html" />
    <link rel="up" title="Using IPython for parallel computing" href="index.html" />
    <link rel="next" title="Parallel Magic Commands" href="magics.html" />
    <link rel="prev" title="Starting the IPython controller and engines" href="parallel_process.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="https://ipython.org/"><img src="../_static/logo.png" border="0" alt="IPython Documentation"/></a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="magics.html" title="Parallel Magic Commands"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="parallel_process.html" title="Starting the IPython controller and engines"
             accesskey="P">previous</a> |</li>
        <li><a href="https://ipython.org">home</a>|&nbsp;</li>
        <li><a href="../search.html">search</a>|&nbsp;</li>
       <li><a href="../index.html">documentation </a> &raquo;</li>

          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Using IPython for parallel computing</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">IPython&#8217;s Direct interface</a><ul>
<li><a class="reference internal" href="#starting-the-ipython-controller-and-engines">Starting the IPython controller and engines</a></li>
<li><a class="reference internal" href="#creating-a-directview-instance">Creating a <code class="docutils literal"><span class="pre">DirectView</span></code> instance</a></li>
<li><a class="reference internal" href="#quick-and-easy-parallelism">Quick and easy parallelism</a><ul>
<li><a class="reference internal" href="#parallel-map">Parallel map</a></li>
<li><a class="reference internal" href="#remote-function-decorators">Remote function decorators</a></li>
</ul>
</li>
<li><a class="reference internal" href="#calling-python-functions">Calling Python functions</a><ul>
<li><a class="reference internal" href="#apply">apply</a></li>
<li><a class="reference internal" href="#blocking-execution">Blocking execution</a></li>
<li><a class="reference internal" href="#non-blocking-execution">Non-blocking execution</a></li>
<li><a class="reference internal" href="#the-block-and-targets-keyword-arguments-and-attributes">The <code class="docutils literal"><span class="pre">block</span></code> and <code class="docutils literal"><span class="pre">targets</span></code> keyword arguments and attributes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#moving-python-objects-around">Moving Python objects around</a><ul>
<li><a class="reference internal" href="#basic-push-and-pull">Basic push and pull</a></li>
<li><a class="reference internal" href="#dictionary-interface">Dictionary interface</a></li>
<li><a class="reference internal" href="#scatter-and-gather">Scatter and gather</a></li>
</ul>
</li>
<li><a class="reference internal" href="#other-things-to-look-at">Other things to look at</a><ul>
<li><a class="reference internal" href="#how-to-do-parallel-list-comprehensions">How to do parallel list comprehensions</a></li>
<li><a class="reference internal" href="#remote-imports">Remote imports</a></li>
<li><a class="reference internal" href="#parallel-exceptions">Parallel exceptions</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="parallel_process.html"
                        title="previous chapter">Starting the IPython controller and engines</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="magics.html"
                        title="next chapter">Parallel Magic Commands</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/parallel/parallel_multiengine.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <blockquote>
<div><div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This documentation is for an old version of IPython.
You can find docs for newer versions <a class="reference external" href="http://ipython.readthedocs.org/en/stable/">here</a>.</p>
</div>
</div></blockquote>
<div class="section" id="ipython-s-direct-interface">
<span id="parallel-multiengine"></span><h1>IPython&#8217;s Direct interface<a class="headerlink" href="#ipython-s-direct-interface" title="Permalink to this headline">¶</a></h1>
<p>The direct, or multiengine, interface represents one possible way of working with a set of
IPython engines. The basic idea behind the multiengine interface is that the
capabilities of each engine are directly and explicitly exposed to the user.
Thus, in the multiengine interface, each engine is given an id that is used to
identify the engine and give it work to do. This interface is very intuitive
and is designed with interactive usage in mind, and is the best place for
new users of IPython to begin.</p>
<div class="section" id="starting-the-ipython-controller-and-engines">
<h2>Starting the IPython controller and engines<a class="headerlink" href="#starting-the-ipython-controller-and-engines" title="Permalink to this headline">¶</a></h2>
<p>To follow along with this tutorial, you will need to start the IPython
controller and four IPython engines. The simplest way of doing this is to use
the <strong class="command">ipcluster</strong> command:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ipcluster start -n 4
</pre></div>
</div>
<p>For more detailed information about starting the controller and engines, see
our <a class="reference internal" href="parallel_intro.html#parallel-overview"><span>introduction</span></a> to using IPython for parallel computing.</p>
</div>
<div class="section" id="creating-a-directview-instance">
<h2>Creating a <code class="docutils literal"><span class="pre">DirectView</span></code> instance<a class="headerlink" href="#creating-a-directview-instance" title="Permalink to this headline">¶</a></h2>
<p>The first step is to import the IPython <a class="reference internal" href="../api/generated/IPython.parallel.html#module-IPython.parallel" title="IPython.parallel"><code class="xref py py-mod docutils literal"><span class="pre">IPython.parallel</span></code></a>
module and then create a <a class="reference internal" href="../api/generated/IPython.parallel.client.client.html#IPython.parallel.client.client.Client" title="IPython.parallel.client.client.Client"><code class="xref py py-class docutils literal"><span class="pre">Client</span></code></a> instance:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1]: </span><span class="kn">from</span> <span class="nn">IPython.parallel</span> <span class="kn">import</span> <span class="n">Client</span>

<span class="gp">In [2]: </span><span class="n">rc</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
</pre></div>
</div>
<p>This form assumes that the default connection information (stored in
<code class="file docutils literal"><span class="pre">ipcontroller-client.json</span></code> found in <code class="file docutils literal"><span class="pre">IPYTHONDIR/profile_default/security</span></code>) is
accurate. If the controller was started on a remote machine, you must copy that connection
file to the client machine, or enter its contents as arguments to the Client constructor:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="go"># If you have copied the json connector file from the controller:</span>
<span class="gp">In [2]: </span><span class="n">rc</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="s">&#39;/path/to/ipcontroller-client.json&#39;</span><span class="p">)</span>
<span class="go"># or to connect with a specific profile you have set up:</span>
<span class="gp">In [3]: </span><span class="n">rc</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">profile</span><span class="o">=</span><span class="s">&#39;mpi&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>To make sure there are engines connected to the controller, users can get a list
of engine ids:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [3]: </span><span class="n">rc</span><span class="o">.</span><span class="n">ids</span>
<span class="gh">Out[3]: </span><span class="go">[0, 1, 2, 3]</span>
</pre></div>
</div>
<p>Here we see that there are four engines ready to do work for us.</p>
<p>For direct execution, we will make use of a <code class="xref py py-class docutils literal"><span class="pre">DirectView</span></code> object, which can be
constructed via list-access to the client:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [4]: </span><span class="n">dview</span> <span class="o">=</span> <span class="n">rc</span><span class="p">[:]</span> <span class="c"># use all engines</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">For more information, see the in-depth explanation of <a class="reference internal" href="parallel_details.html#parallel-details"><span>Views</span></a>.</p>
</div>
</div>
<div class="section" id="quick-and-easy-parallelism">
<h2>Quick and easy parallelism<a class="headerlink" href="#quick-and-easy-parallelism" title="Permalink to this headline">¶</a></h2>
<p>In many cases, you simply want to apply a Python function to a sequence of
objects, but <em>in parallel</em>. The client interface provides a simple way
of accomplishing this: using the DirectView&#8217;s <code class="xref py py-meth docutils literal"><span class="pre">map()</span></code> method.</p>
<div class="section" id="parallel-map">
<h3>Parallel map<a class="headerlink" href="#parallel-map" title="Permalink to this headline">¶</a></h3>
<p>Python&#8217;s builtin <a class="reference external" href="http://docs.python.org/2/library/functions.html#map" title="(in Python v2.7)"><code class="xref py py-func docutils literal"><span class="pre">map()</span></code></a> functions allows a function to be applied to a
sequence element-by-element. This type of code is typically trivial to
parallelize. In fact, since IPython&#8217;s interface is all about functions anyway,
you can just use the builtin <a class="reference external" href="http://docs.python.org/2/library/functions.html#map" title="(in Python v2.7)"><code class="xref py py-func docutils literal"><span class="pre">map()</span></code></a> with a <code class="xref py py-class docutils literal"><span class="pre">RemoteFunction</span></code>, or a
DirectView&#8217;s <code class="xref py py-meth docutils literal"><span class="pre">map()</span></code> method:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [62]: </span><span class="n">serial_result</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">**</span><span class="mi">10</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span>

<span class="gp">In [63]: </span><span class="n">parallel_result</span> <span class="o">=</span> <span class="n">dview</span><span class="o">.</span><span class="n">map_sync</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">10</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span>

<span class="gp">In [67]: </span><span class="n">serial_result</span><span class="o">==</span><span class="n">parallel_result</span>
<span class="gh">Out[67]: </span><span class="go">True</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="xref py py-class docutils literal"><span class="pre">DirectView</span></code>&#8216;s version of <code class="xref py py-meth docutils literal"><span class="pre">map()</span></code> does
not do dynamic load balancing. For a load balanced version, use a
<code class="xref py py-class docutils literal"><span class="pre">LoadBalancedView</span></code>.</p>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><code class="xref py py-meth docutils literal"><span class="pre">map()</span></code> is implemented via <code class="xref py py-class docutils literal"><span class="pre">ParallelFunction</span></code>.</p>
</div>
</div>
<div class="section" id="remote-function-decorators">
<h3>Remote function decorators<a class="headerlink" href="#remote-function-decorators" title="Permalink to this headline">¶</a></h3>
<p>Remote functions are just like normal functions, but when they are called,
they execute on one or more engines, rather than locally. IPython provides
two decorators:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [10]: </span><span class="nd">@dview.remote</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">   ....: </span><span class="k">def</span> <span class="nf">getpid</span><span class="p">():</span>
<span class="gp">   ....: </span>    <span class="kn">import</span> <span class="nn">os</span>
<span class="gp">   ....: </span>    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()</span>
<span class="gp">   ....:</span>

<span class="gp">In [11]: </span><span class="n">getpid</span><span class="p">()</span>
<span class="gh">Out[11]: </span><span class="go">[12345, 12346, 12347, 12348]</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">&#64;parallel</span></code> decorator creates parallel functions, that break up an element-wise
operations and distribute them, reconstructing the result.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [12]: </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="gp">In [13]: </span><span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">64</span><span class="p">,</span><span class="mi">48</span><span class="p">))</span>

<span class="gp">In [14]: </span><span class="nd">@dview.parallel</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">   ....: </span><span class="k">def</span> <span class="nf">pmul</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">):</span>
<span class="gp">   ....: </span>    <span class="k">return</span> <span class="n">A</span><span class="o">*</span><span class="n">B</span>

<span class="gp">In [15]: </span><span class="n">C_local</span> <span class="o">=</span> <span class="n">A</span><span class="o">*</span><span class="n">A</span>

<span class="gp">In [16]: </span><span class="n">C_remote</span> <span class="o">=</span> <span class="n">pmul</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">A</span><span class="p">)</span>

<span class="gp">In [17]: </span><span class="p">(</span><span class="n">C_local</span> <span class="o">==</span> <span class="n">C_remote</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="gh">Out[17]: </span><span class="go">True</span>
</pre></div>
</div>
<p>Calling a <code class="docutils literal"><span class="pre">&#64;parallel</span></code> function <em>does not</em> correspond to map. It is used for splitting
element-wise operations that operate on a sequence or array.  For <code class="docutils literal"><span class="pre">map</span></code> behavior,
parallel functions do have a map method.</p>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="36%" />
<col width="38%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">call</th>
<th class="head">pfunc(seq)</th>
<th class="head">pfunc.map(seq)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td># of tasks</td>
<td># of engines (1 per engine)</td>
<td># of engines (1 per engine)</td>
</tr>
<tr class="row-odd"><td># of remote calls</td>
<td># of engines (1 per engine)</td>
<td><code class="docutils literal"><span class="pre">len(seq)</span></code></td>
</tr>
<tr class="row-even"><td>argument to remote</td>
<td><code class="docutils literal"><span class="pre">seq[i:j]</span></code> (sub-sequence)</td>
<td><code class="docutils literal"><span class="pre">seq[i]</span></code> (single element)</td>
</tr>
</tbody>
</table>
<p>A quick example to illustrate the difference in arguments for the two modes:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [16]: </span><span class="nd">@dview.parallel</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">   ....: </span><span class="k">def</span> <span class="nf">echo</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">   ....: </span>    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">   ....:</span>

<span class="gp">In [17]: </span><span class="n">echo</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="gh">Out[17]: </span><span class="go">[&#39;[0, 1]&#39;, &#39;[2]&#39;, &#39;[3]&#39;, &#39;[4]&#39;]</span>

<span class="gp">In [18]: </span><span class="n">echo</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="gh">Out[18]: </span><span class="go">[&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;]</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">See the <a class="reference internal" href="../api/generated/IPython.parallel.client.remotefunction.html#IPython.parallel.client.remotefunction.parallel" title="IPython.parallel.client.remotefunction.parallel"><code class="xref py py-func docutils literal"><span class="pre">parallel()</span></code></a> and <a class="reference internal" href="../api/generated/IPython.parallel.client.remotefunction.html#IPython.parallel.client.remotefunction.remote" title="IPython.parallel.client.remotefunction.remote"><code class="xref py py-func docutils literal"><span class="pre">remote()</span></code></a>
decorators for options.</p>
</div>
</div>
</div>
<div class="section" id="calling-python-functions">
<h2>Calling Python functions<a class="headerlink" href="#calling-python-functions" title="Permalink to this headline">¶</a></h2>
<p>The most basic type of operation that can be performed on the engines is to
execute Python code or call Python functions. Executing Python code can be
done in blocking or non-blocking mode (non-blocking is default) using the
<code class="xref py py-meth docutils literal"><span class="pre">View.execute()</span></code> method, and calling functions can be done via the
<a class="reference internal" href="../api/generated/IPython.parallel.client.view.html#IPython.parallel.client.view.View.apply" title="IPython.parallel.client.view.View.apply"><code class="xref py py-meth docutils literal"><span class="pre">View.apply()</span></code></a> method.</p>
<div class="section" id="apply">
<h3>apply<a class="headerlink" href="#apply" title="Permalink to this headline">¶</a></h3>
<p>The main method for doing remote execution (in fact, all methods that
communicate with the engines are built on top of it), is <code class="xref py py-meth docutils literal"><span class="pre">View.apply()</span></code>.</p>
<p>We strive to provide the cleanest interface we can, so <code class="docutils literal"><span class="pre">apply</span></code> has the following
signature:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">view</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<p>There are various ways to call functions with IPython, and these flags are set as
attributes of the View.  The <code class="docutils literal"><span class="pre">DirectView</span></code> has just two of these flags:</p>
<dl class="docutils">
<dt>dv.block <span class="classifier-delimiter">:</span> <span class="classifier">bool</span></dt>
<dd>whether to wait for the result, or return an <a class="reference internal" href="parallel_details.html#AsyncResult" title="AsyncResult"><code class="xref py py-class docutils literal"><span class="pre">AsyncResult</span></code></a> object
immediately</dd>
<dt>dv.track <span class="classifier-delimiter">:</span> <span class="classifier">bool</span></dt>
<dd>whether to instruct pyzmq to track when zeromq is done sending the message.
This is primarily useful for non-copying sends of numpy arrays that you plan to
edit in-place.  You need to know when it becomes safe to edit the buffer
without corrupting the message.</dd>
<dt>dv.targets <span class="classifier-delimiter">:</span> <span class="classifier">int, list of ints</span></dt>
<dd>which targets this view is associated with.</dd>
</dl>
<p>Creating a view is simple: index-access on a client creates a <a class="reference internal" href="../api/generated/IPython.parallel.client.view.html#IPython.parallel.client.view.DirectView" title="IPython.parallel.client.view.DirectView"><code class="xref py py-class docutils literal"><span class="pre">DirectView</span></code></a>.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [4]: </span><span class="n">view</span> <span class="o">=</span> <span class="n">rc</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="gh">Out[4]: </span><span class="go">&lt;DirectView [1, 2]&gt;</span>

<span class="gp">In [5]: </span><span class="n">view</span><span class="o">.</span><span class="n">apply</span><span class="o">&lt;</span><span class="n">tab</span><span class="o">&gt;</span>
<span class="go">view.apply  view.apply_async  view.apply_sync</span>
</pre></div>
</div>
<p>For convenience, you can set block temporarily for a single call with the extra sync/async methods.</p>
</div>
<div class="section" id="blocking-execution">
<h3>Blocking execution<a class="headerlink" href="#blocking-execution" title="Permalink to this headline">¶</a></h3>
<p>In blocking mode, the <a class="reference internal" href="../api/generated/IPython.parallel.client.view.html#IPython.parallel.client.view.DirectView" title="IPython.parallel.client.view.DirectView"><code class="xref py py-class docutils literal"><span class="pre">DirectView</span></code></a> object (called <code class="docutils literal"><span class="pre">dview</span></code> in
these examples) submits the command to the controller, which places the
command in the engines&#8217; queues for execution. The <code class="xref py py-meth docutils literal"><span class="pre">apply()</span></code> call then
blocks until the engines are done executing the command:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [2]: </span><span class="n">dview</span> <span class="o">=</span> <span class="n">rc</span><span class="p">[:]</span> <span class="c"># A DirectView of all engines</span>
<span class="gp">In [3]: </span><span class="n">dview</span><span class="o">.</span><span class="n">block</span><span class="o">=</span><span class="bp">True</span>
<span class="gp">In [4]: </span><span class="n">dview</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>

<span class="gp">In [5]: </span><span class="n">dview</span><span class="p">[</span><span class="s">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>

<span class="gp">In [6]: </span><span class="n">dview</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">+</span><span class="n">x</span><span class="p">,</span> <span class="mi">27</span><span class="p">)</span>
<span class="gh">Out[6]: </span><span class="go">[42, 42, 42, 42]</span>
</pre></div>
</div>
<p>You can also select blocking execution on a call-by-call basis with the <code class="xref py py-meth docutils literal"><span class="pre">apply_sync()</span></code>
method:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [7]: </span><span class="n">dview</span><span class="o">.</span><span class="n">block</span><span class="o">=</span><span class="bp">False</span>

<span class="gp">In [8]: </span><span class="n">dview</span><span class="o">.</span><span class="n">apply_sync</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">+</span><span class="n">x</span><span class="p">,</span> <span class="mi">27</span><span class="p">)</span>
<span class="gh">Out[8]: </span><span class="go">[42, 42, 42, 42]</span>
</pre></div>
</div>
<p>Python commands can be executed as strings on specific engines by using a View&#8217;s <code class="docutils literal"><span class="pre">execute</span></code>
method:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [6]: </span><span class="n">rc</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;c=a+b&#39;</span><span class="p">)</span>

<span class="gp">In [7]: </span><span class="n">rc</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;c=a-b&#39;</span><span class="p">)</span>

<span class="gp">In [8]: </span><span class="n">dview</span><span class="p">[</span><span class="s">&#39;c&#39;</span><span class="p">]</span> <span class="c"># shorthand for dview.pull(&#39;c&#39;, block=True)</span>
<span class="gh">Out[8]: </span><span class="go">[15, -5, 15, -5]</span>
</pre></div>
</div>
</div>
<div class="section" id="non-blocking-execution">
<h3>Non-blocking execution<a class="headerlink" href="#non-blocking-execution" title="Permalink to this headline">¶</a></h3>
<p>In non-blocking mode, <code class="xref py py-meth docutils literal"><span class="pre">apply()</span></code> submits the command to be executed and
then returns a <a class="reference internal" href="parallel_details.html#AsyncResult" title="AsyncResult"><code class="xref py py-class docutils literal"><span class="pre">AsyncResult</span></code></a> object immediately. The
<a class="reference internal" href="parallel_details.html#AsyncResult" title="AsyncResult"><code class="xref py py-class docutils literal"><span class="pre">AsyncResult</span></code></a> object gives you a way of getting a result at a later
time through its <code class="xref py py-meth docutils literal"><span class="pre">get()</span></code> method.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">Docs on the <a class="reference internal" href="asyncresult.html#parallel-asyncresult"><span>AsyncResult</span></a> object.</p>
</div>
<p>This allows you to quickly submit long running commands without blocking your
local Python/IPython session:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="go"># define our function</span>
<span class="gp">In [6]: </span><span class="k">def</span> <span class="nf">wait</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
<span class="go">  ....:     import time</span>
<span class="go">  ....:     tic = time.time()</span>
<span class="go">  ....:     time.sleep(t)</span>
<span class="go">  ....:     return time.time()-tic</span>

<span class="go"># In non-blocking mode</span>
<span class="gp">In [7]: </span><span class="n">ar</span> <span class="o">=</span> <span class="n">dview</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">wait</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="go"># Now block for the result</span>
<span class="gp">In [8]: </span><span class="n">ar</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="gh">Out[8]: </span><span class="go">[2.0006198883056641, 1.9997570514678955, 1.9996809959411621, 2.0003249645233154]</span>

<span class="go"># Again in non-blocking mode</span>
<span class="gp">In [9]: </span><span class="n">ar</span> <span class="o">=</span> <span class="n">dview</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">wait</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="go"># Poll to see if the result is ready</span>
<span class="gp">In [10]: </span><span class="n">ar</span><span class="o">.</span><span class="n">ready</span><span class="p">()</span>
<span class="gh">Out[10]: </span><span class="go">False</span>

<span class="go"># ask for the result, but wait a maximum of 1 second:</span>
<span class="gp">In [45]: </span><span class="n">ar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TimeoutError</span><span class="g-Whitespace">                              </span>Traceback (most recent call last)
<span class="nn">/home/you/&lt;ipython-input-45-7cd858bbb8e0&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">ar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="nn">/path/to/site-packages/IPython/parallel/asyncresult.pyc</span> in <span class="ni">get</span><span class="nt">(self, timeout)</span>
<span class="g-Whitespace">     </span><span class="mi">62</span>                 <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exception</span>
<span class="g-Whitespace">     </span><span class="mi">63</span>         <span class="k">else</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">64</span>             <span class="k">raise</span> <span class="n">error</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">(</span><span class="s">&quot;Result not ready.&quot;</span><span class="p">)</span>
<span class="g-Whitespace">     </span><span class="mi">65</span>
<span class="g-Whitespace">     </span><span class="mi">66</span>     <span class="k">def</span> <span class="nf">ready</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="ne">TimeoutError</span>: Result not ready.
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note the import inside the function. This is a common model, to ensure
that the appropriate modules are imported where the task is run. You can
also manually import modules into the engine(s) namespace(s) via
<code class="docutils literal"><span class="pre">view.execute('import</span> <span class="pre">numpy')</span></code>.</p>
</div>
<p>Often, it is desirable to wait until a set of <a class="reference internal" href="parallel_details.html#AsyncResult" title="AsyncResult"><code class="xref py py-class docutils literal"><span class="pre">AsyncResult</span></code></a> objects
are done. For this, there is a the method <code class="xref py py-meth docutils literal"><span class="pre">wait()</span></code>. This method takes a
tuple of <a class="reference internal" href="parallel_details.html#AsyncResult" title="AsyncResult"><code class="xref py py-class docutils literal"><span class="pre">AsyncResult</span></code></a> objects (or <code class="docutils literal"><span class="pre">msg_ids</span></code> or indices to the client&#8217;s History),
and blocks until all of the associated results are ready:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [72]: </span><span class="n">dview</span><span class="o">.</span><span class="n">block</span><span class="o">=</span><span class="bp">False</span>

<span class="go"># A trivial list of AsyncResults objects</span>
<span class="gp">In [73]: </span><span class="n">pr_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">dview</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">wait</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>

<span class="go"># Wait until all of them are done</span>
<span class="gp">In [74]: </span><span class="n">dview</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">pr_list</span><span class="p">)</span>

<span class="go"># Then, their results are ready using get() or the `.r` attribute</span>
<span class="gp">In [75]: </span><span class="n">pr_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="gh">Out[75]: </span><span class="go">[2.9982571601867676, 2.9982588291168213, 2.9987530708312988, 2.9990990161895752]</span>
</pre></div>
</div>
</div>
<div class="section" id="the-block-and-targets-keyword-arguments-and-attributes">
<h3>The <code class="docutils literal"><span class="pre">block</span></code> and <code class="docutils literal"><span class="pre">targets</span></code> keyword arguments and attributes<a class="headerlink" href="#the-block-and-targets-keyword-arguments-and-attributes" title="Permalink to this headline">¶</a></h3>
<p>Most DirectView methods (excluding <code class="xref py py-meth docutils literal"><span class="pre">apply()</span></code>) accept <code class="docutils literal"><span class="pre">block</span></code> and
<code class="docutils literal"><span class="pre">targets</span></code> as keyword arguments. As we have seen above, these keyword arguments control the
blocking mode and which engines the command is applied to. The <code class="xref py py-class docutils literal"><span class="pre">View</span></code> class also has
<code class="xref py py-attr docutils literal"><span class="pre">block</span></code> and <code class="xref py py-attr docutils literal"><span class="pre">targets</span></code> attributes that control the default behavior when the keyword
arguments are not provided. Thus the following logic is used for <code class="xref py py-attr docutils literal"><span class="pre">block</span></code> and <code class="xref py py-attr docutils literal"><span class="pre">targets</span></code>:</p>
<ul class="simple">
<li>If no keyword argument is provided, the instance attributes are used.</li>
<li>The Keyword arguments, if provided overrides the instance attributes for
the duration of a single call.</li>
</ul>
<p>The following examples demonstrate how to use the instance attributes:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [16]: </span><span class="n">dview</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>

<span class="gp">In [17]: </span><span class="n">dview</span><span class="o">.</span><span class="n">block</span> <span class="o">=</span> <span class="bp">False</span>

<span class="gp">In [18]: </span><span class="n">ar</span> <span class="o">=</span> <span class="n">dview</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="p">:</span> <span class="mi">10</span><span class="p">)</span>

<span class="gp">In [19]: </span><span class="n">ar</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="gh">Out[19]: </span><span class="go">[10, 10]</span>

<span class="gp">In [20]: </span><span class="n">dview</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">rc</span><span class="o">.</span><span class="n">ids</span> <span class="c"># all engines (4)</span>

<span class="gp">In [21]: </span><span class="n">dview</span><span class="o">.</span><span class="n">block</span> <span class="o">=</span> <span class="bp">True</span>

<span class="gp">In [22]: </span><span class="n">dview</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="p">:</span> <span class="mi">42</span><span class="p">)</span>
<span class="gh">Out[22]: </span><span class="go">[42, 42, 42, 42]</span>
</pre></div>
</div>
<p>The <code class="xref py py-attr docutils literal"><span class="pre">block</span></code> and <code class="xref py py-attr docutils literal"><span class="pre">targets</span></code> instance attributes of the
<a class="reference internal" href="../api/generated/IPython.parallel.client.view.html#IPython.parallel.client.view.DirectView" title="IPython.parallel.client.view.DirectView"><code class="xref py py-class docutils literal"><span class="pre">DirectView</span></code></a> also determine the behavior of the parallel magic commands.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">See the documentation of the <a class="reference internal" href="magics.html#parallel-magics"><span>Parallel Magics</span></a>.</p>
</div>
</div>
</div>
<div class="section" id="moving-python-objects-around">
<h2>Moving Python objects around<a class="headerlink" href="#moving-python-objects-around" title="Permalink to this headline">¶</a></h2>
<p>In addition to calling functions and executing code on engines, you can
transfer Python objects to and from your IPython session and the engines. In
IPython, these operations are called <code class="xref py py-meth docutils literal"><span class="pre">push()</span></code> (sending an object to the
engines) and <code class="xref py py-meth docutils literal"><span class="pre">pull()</span></code> (getting an object from the engines).</p>
<div class="section" id="basic-push-and-pull">
<h3>Basic push and pull<a class="headerlink" href="#basic-push-and-pull" title="Permalink to this headline">¶</a></h3>
<p>Here are some examples of how you use <code class="xref py py-meth docutils literal"><span class="pre">push()</span></code> and <code class="xref py py-meth docutils literal"><span class="pre">pull()</span></code>:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [38]: </span><span class="n">dview</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">1.03234</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">3453</span><span class="p">))</span>
<span class="gh">Out[38]: </span><span class="go">[None,None,None,None]</span>

<span class="gp">In [39]: </span><span class="n">dview</span><span class="o">.</span><span class="n">pull</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
<span class="gh">Out[39]: </span><span class="go">[ 1.03234, 1.03234, 1.03234, 1.03234]</span>

<span class="gp">In [40]: </span><span class="n">dview</span><span class="o">.</span><span class="n">pull</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gh">Out[40]: </span><span class="go">3453</span>

<span class="gp">In [41]: </span><span class="n">dview</span><span class="o">.</span><span class="n">pull</span><span class="p">((</span><span class="s">&#39;a&#39;</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">))</span>
<span class="gh">Out[41]: </span><span class="go">[ [1.03234, 3453], [1.03234, 3453], [1.03234, 3453], [1.03234, 3453] ]</span>

<span class="gp">In [42]: </span><span class="n">dview</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="s">&#39;speed&#39;</span><span class="p">))</span>
<span class="gh">Out[42]: </span><span class="go">[None,None,None,None]</span>
</pre></div>
</div>
<p>In non-blocking mode <code class="xref py py-meth docutils literal"><span class="pre">push()</span></code> and <code class="xref py py-meth docutils literal"><span class="pre">pull()</span></code> also return
<a class="reference internal" href="parallel_details.html#AsyncResult" title="AsyncResult"><code class="xref py py-class docutils literal"><span class="pre">AsyncResult</span></code></a> objects:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [48]: </span><span class="n">ar</span> <span class="o">=</span> <span class="n">dview</span><span class="o">.</span><span class="n">pull</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="gp">In [49]: </span><span class="n">ar</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="gh">Out[49]: </span><span class="go">[1.03234, 1.03234, 1.03234, 1.03234]</span>
</pre></div>
</div>
</div>
<div class="section" id="dictionary-interface">
<h3>Dictionary interface<a class="headerlink" href="#dictionary-interface" title="Permalink to this headline">¶</a></h3>
<p>Since a Python namespace is just a <a class="reference external" href="http://docs.python.org/2/library/stdtypes.html#dict" title="(in Python v2.7)"><code class="xref py py-class docutils literal"><span class="pre">dict</span></code></a>, <code class="xref py py-class docutils literal"><span class="pre">DirectView</span></code> objects provide
dictionary-style access by key and methods such as <code class="xref py py-meth docutils literal"><span class="pre">get()</span></code> and
<code class="xref py py-meth docutils literal"><span class="pre">update()</span></code> for convenience. This make the remote namespaces of the engines
appear as a local dictionary. Underneath, these methods call <code class="xref py py-meth docutils literal"><span class="pre">apply()</span></code>:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [51]: </span><span class="n">dview</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">,</span><span class="s">&#39;bar&#39;</span><span class="p">]</span>

<span class="gp">In [52]: </span><span class="n">dview</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">]</span>
<span class="gh">Out[52]: </span><span class="go">[ [&#39;foo&#39;, &#39;bar&#39;], [&#39;foo&#39;, &#39;bar&#39;], [&#39;foo&#39;, &#39;bar&#39;], [&#39;foo&#39;, &#39;bar&#39;] ]</span>
</pre></div>
</div>
</div>
<div class="section" id="scatter-and-gather">
<h3>Scatter and gather<a class="headerlink" href="#scatter-and-gather" title="Permalink to this headline">¶</a></h3>
<p>Sometimes it is useful to partition a sequence and push the partitions to
different engines. In MPI language, this is know as scatter/gather and we
follow that terminology. However, it is important to remember that in
IPython&#8217;s <code class="xref py py-class docutils literal"><span class="pre">Client</span></code> class, <code class="xref py py-meth docutils literal"><span class="pre">scatter()</span></code> is from the
interactive IPython session to the engines and <code class="xref py py-meth docutils literal"><span class="pre">gather()</span></code> is from the
engines back to the interactive IPython session. For scatter/gather operations
between engines, MPI, pyzmq, or some other direct interconnect should be used.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [58]: </span><span class="n">dview</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span>
<span class="gh">Out[58]: </span><span class="go">[None,None,None,None]</span>

<span class="gp">In [59]: </span><span class="n">dview</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">]</span>
<span class="gh">Out[59]: </span><span class="go">[ [0, 1, 2, 3], [4, 5, 6, 7], [8, 9, 10, 11], [12, 13, 14, 15] ]</span>

<span class="gp">In [60]: </span><span class="n">dview</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
<span class="gh">Out[60]: </span><span class="go">[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="other-things-to-look-at">
<h2>Other things to look at<a class="headerlink" href="#other-things-to-look-at" title="Permalink to this headline">¶</a></h2>
<div class="section" id="how-to-do-parallel-list-comprehensions">
<h3>How to do parallel list comprehensions<a class="headerlink" href="#how-to-do-parallel-list-comprehensions" title="Permalink to this headline">¶</a></h3>
<p>In many cases list comprehensions are nicer than using the map function. While
we don&#8217;t have fully parallel list comprehensions, it is simple to get the
basic effect using <code class="xref py py-meth docutils literal"><span class="pre">scatter()</span></code> and <code class="xref py py-meth docutils literal"><span class="pre">gather()</span></code>:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [66]: </span><span class="n">dview</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="mi">64</span><span class="p">))</span>

<span class="gp">In [67]: </span><span class="o">%</span><span class="k">px</span> y = [i**10 for i in x]
<span class="go">Parallel execution on engines: [0, 1, 2, 3]</span>

<span class="gp">In [68]: </span><span class="n">y</span> <span class="o">=</span> <span class="n">dview</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">)</span>

<span class="gp">In [69]: </span><span class="k">print</span> <span class="n">y</span>
<span class="go">[0, 1, 1024, 59049, 1048576, 9765625, 60466176, 282475249, 1073741824,...]</span>
</pre></div>
</div>
</div>
<div class="section" id="remote-imports">
<h3>Remote imports<a class="headerlink" href="#remote-imports" title="Permalink to this headline">¶</a></h3>
<p>Sometimes you will want to import packages both in your interactive session
and on your remote engines.  This can be done with the <code class="xref py py-class docutils literal"><span class="pre">ContextManager</span></code>
created by a DirectView&#8217;s <code class="xref py py-meth docutils literal"><span class="pre">sync_imports()</span></code> method:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [69]: </span><span class="k">with</span> <span class="n">dview</span><span class="o">.</span><span class="n">sync_imports</span><span class="p">():</span>
<span class="gp">   ....: </span>    <span class="kn">import</span> <span class="nn">numpy</span>
<span class="go">importing numpy on engine(s)</span>
</pre></div>
</div>
<p>Any imports made inside the block will also be performed on the view&#8217;s engines.
sync_imports also takes a <code class="docutils literal"><span class="pre">local</span></code> boolean flag that defaults to True, which specifies
whether the local imports should also be performed.  However, support for <code class="docutils literal"><span class="pre">local=False</span></code>
has not been implemented, so only packages that can be imported locally will work
this way. Note that the usual renaming of the import handle in the same line like in
<code class="docutils literal"><span class="pre">import</span> <span class="pre">matplotlib.pyplot</span> <span class="pre">as</span> <span class="pre">plt'</span> <span class="pre">does</span> <span class="pre">not</span> <span class="pre">work</span> <span class="pre">on</span> <span class="pre">the</span> <span class="pre">remote</span> <span class="pre">engine,</span> <span class="pre">the</span> <span class="pre">`as</span> <span class="pre">plt</span></code> is
ignored remotely, while it executes locally. One could rename the remote handle with
<code class="docutils literal"><span class="pre">%px</span> <span class="pre">plt</span> <span class="pre">=</span> <span class="pre">pyplot</span></code> though after the import.</p>
<p>You can also specify imports via the <code class="docutils literal"><span class="pre">&#64;require</span></code> decorator.  This is a decorator
designed for use in Dependencies, but can be used to handle remote imports as well.
Modules or module names passed to <code class="docutils literal"><span class="pre">&#64;require</span></code> will be imported before the decorated
function is called.  If they cannot be imported, the decorated function will never
execute and will fail with an UnmetDependencyError. Failures of single Engines will
be collected and raise a CompositeError, as demonstrated in the next section.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [69]: </span><span class="kn">from</span> <span class="nn">IPython.parallel</span> <span class="kn">import</span> <span class="n">require</span>

<span class="gp">In [70]: </span><span class="nd">@require</span><span class="p">(</span><span class="s">&#39;re&#39;</span><span class="p">)</span>
<span class="gp">   ....: </span><span class="k">def</span> <span class="nf">findall</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="gp">   ....: </span>    <span class="c"># re is guaranteed to be available</span>
<span class="gp">   ....: </span>    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

<span class="go"># you can also pass modules themselves, that you already have locally:</span>
<span class="gp">In [71]: </span><span class="nd">@require</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
<span class="gp">   ....: </span><span class="k">def</span> <span class="nf">wait</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
<span class="gp">   ....: </span>    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="gp">   ....: </span>    <span class="k">return</span> <span class="n">t</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="xref py py-func docutils literal"><span class="pre">sync_imports()</span></code> does not allow <code class="docutils literal"><span class="pre">import</span> <span class="pre">foo</span> <span class="pre">as</span> <span class="pre">bar</span></code> syntax,
because the assignment represented by the <code class="docutils literal"><span class="pre">as</span> <span class="pre">bar</span></code> part is not
available to the import hook.</p>
</div>
</div>
<div class="section" id="parallel-exceptions">
<span id="id1"></span><h3>Parallel exceptions<a class="headerlink" href="#parallel-exceptions" title="Permalink to this headline">¶</a></h3>
<p>In the multiengine interface, parallel commands can raise Python exceptions,
just like serial commands. But it is a little subtle, because a single
parallel command can actually raise multiple exceptions (one for each engine
the command was run on). To express this idea, we have a
<code class="xref py py-exc docutils literal"><span class="pre">CompositeError</span></code> exception class that will be raised in most cases. The
<code class="xref py py-exc docutils literal"><span class="pre">CompositeError</span></code> class is a special type of exception that wraps one or
more other types of exceptions. Here is how it works:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [78]: </span><span class="n">dview</span><span class="o">.</span><span class="n">block</span> <span class="o">=</span> <span class="bp">True</span>

<span class="gp">In [79]: </span><span class="n">dview</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;1/0&quot;</span><span class="p">)</span>
<span class="go">[0:execute]:</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ZeroDivisionError</span><span class="g-Whitespace">                         </span>Traceback (most recent call last)
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="mi">1</span><span class="o">/</span><span class="mi">0</span>
<span class="ne">ZeroDivisionError</span>: integer division or modulo by zero

<span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">execute</span><span class="p">]:</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ZeroDivisionError</span><span class="g-Whitespace">                         </span>Traceback (most recent call last)
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="mi">1</span><span class="o">/</span><span class="mi">0</span>
<span class="ne">ZeroDivisionError</span>: integer division or modulo by zero

<span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="n">execute</span><span class="p">]:</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ZeroDivisionError</span><span class="g-Whitespace">                         </span>Traceback (most recent call last)
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="mi">1</span><span class="o">/</span><span class="mi">0</span>
<span class="ne">ZeroDivisionError</span>: integer division or modulo by zero

<span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="n">execute</span><span class="p">]:</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ZeroDivisionError</span><span class="g-Whitespace">                         </span>Traceback (most recent call last)
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="mi">1</span><span class="o">/</span><span class="mi">0</span>
<span class="ne">ZeroDivisionError</span>: integer division or modulo by zero
</pre></div>
</div>
<p>Notice how the error message printed when <code class="xref py py-exc docutils literal"><span class="pre">CompositeError</span></code> is raised has
information about the individual exceptions that were raised on each engine.
If you want, you can even raise one of these original exceptions:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [79]: </span><span class="kn">from</span> <span class="nn">IPython.parallel</span> <span class="kn">import</span> <span class="n">CompositeError</span>

<span class="gp">In [80]: </span><span class="k">try</span><span class="p">:</span>
<span class="gp">   ....: </span>    <span class="n">dview</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;1/0&#39;</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">   ....: </span><span class="k">except</span> <span class="n">CompositeError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
<span class="gp">   ....: </span>    <span class="n">e</span><span class="o">.</span><span class="n">raise_exception</span><span class="p">()</span>
<span class="gp">   ....:</span>
<span class="gp">   ....:</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ZeroDivisionError</span><span class="g-Whitespace">                         </span>Traceback (most recent call last)
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="mi">1</span><span class="o">/</span><span class="mi">0</span>
<span class="ne">ZeroDivisionError</span>: integer division or modulo by zero
</pre></div>
</div>
<p>If you are working in IPython, you can simple type <code class="docutils literal"><span class="pre">%debug</span></code> after one of
these <code class="xref py py-exc docutils literal"><span class="pre">CompositeError</span></code> exceptions is raised, and inspect the exception
instance:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [81]: </span><span class="n">dview</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;1/0&#39;</span><span class="p">)</span>
<span class="go">[0:execute]:</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ZeroDivisionError</span><span class="g-Whitespace">                         </span>Traceback (most recent call last)
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="mi">1</span><span class="o">/</span><span class="mi">0</span>
<span class="ne">ZeroDivisionError</span>: integer division or modulo by zero

<span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">execute</span><span class="p">]:</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ZeroDivisionError</span><span class="g-Whitespace">                         </span>Traceback (most recent call last)
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="mi">1</span><span class="o">/</span><span class="mi">0</span>
<span class="ne">ZeroDivisionError</span>: integer division or modulo by zero

<span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="n">execute</span><span class="p">]:</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ZeroDivisionError</span><span class="g-Whitespace">                         </span>Traceback (most recent call last)
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="mi">1</span><span class="o">/</span><span class="mi">0</span>
<span class="ne">ZeroDivisionError</span>: integer division or modulo by zero

<span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="n">execute</span><span class="p">]:</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ZeroDivisionError</span><span class="g-Whitespace">                         </span>Traceback (most recent call last)
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="mi">1</span><span class="o">/</span><span class="mi">0</span>
<span class="ne">ZeroDivisionError</span>: integer division or modulo by zero

<span class="gp">In [82]: </span><span class="o">%</span><span class="k">debug</span>
<span class="go">&gt; /.../site-packages/IPython/parallel/client/asyncresult.py(125)get()</span>
<span class="go">    124             else:</span>
<span class="go">--&gt; 125                 raise self._exception</span>
<span class="go">    126         else:</span>

<span class="go"># Here, self._exception is the CompositeError instance:</span>

<span class="go">ipdb&gt; e = self._exception</span>
<span class="go">ipdb&gt; e</span>
<span class="go">CompositeError(4)</span>

<span class="go"># we can tab-complete on e to see available methods:</span>
<span class="go">ipdb&gt; e.&lt;TAB&gt;</span>
<span class="go">e.args               e.message            e.traceback</span>
<span class="go">e.elist              e.msg</span>
<span class="go">e.ename              e.print_traceback</span>
<span class="go">e.engine_info        e.raise_exception</span>
<span class="go">e.evalue             e.render_traceback</span>

<span class="go"># We can then display the individual tracebacks, if we want:</span>
<span class="go">ipdb&gt; e.print_traceback(1)</span>
<span class="go">[1:execute]:</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ZeroDivisionError</span><span class="g-Whitespace">                         </span>Traceback (most recent call last)
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="mi">1</span><span class="o">/</span><span class="mi">0</span>
<span class="ne">ZeroDivisionError</span>: integer division or modulo by zero
</pre></div>
</div>
<p>Since you might have 100 engines, you probably don&#8217;t want to see 100 tracebacks
for a simple NameError because of a typo.
For this reason, CompositeError truncates the list of exceptions it will print
to <code class="xref py py-attr docutils literal"><span class="pre">CompositeError.tb_limit</span></code> (default is five).
You can change this limit to suit your needs with:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [20]: </span><span class="kn">from</span> <span class="nn">IPython.parallel</span> <span class="kn">import</span> <span class="n">CompositeError</span>
<span class="gp">In [21]: </span><span class="n">CompositeError</span><span class="o">.</span><span class="n">tb_limit</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">In [22]: </span><span class="o">%</span><span class="k">px</span> x=z
<span class="go">[0:execute]:</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">x</span><span class="o">=</span><span class="n">z</span>
<span class="ne">NameError</span>: name &#39;z&#39; is not defined

<span class="o">...</span> <span class="mi">3</span> <span class="n">more</span> <span class="n">exceptions</span> <span class="o">...</span>
</pre></div>
</div>
<p>All of this same error handling magic even works in non-blocking mode:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [83]: </span><span class="n">dview</span><span class="o">.</span><span class="n">block</span><span class="o">=</span><span class="bp">False</span>

<span class="gp">In [84]: </span><span class="n">ar</span> <span class="o">=</span> <span class="n">dview</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;1/0&#39;</span><span class="p">)</span>

<span class="gp">In [85]: </span><span class="n">ar</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="go">[0:execute]:</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ZeroDivisionError</span><span class="g-Whitespace">                         </span>Traceback (most recent call last)
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="mi">1</span><span class="o">/</span><span class="mi">0</span>
<span class="ne">ZeroDivisionError</span>: integer division or modulo by zero

<span class="o">...</span> <span class="mi">3</span> <span class="n">more</span> <span class="n">exceptions</span> <span class="o">...</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The IPython Development Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.3</a>
      
      |
      <a href="../_sources/parallel/parallel_multiengine.txt"
          rel="nofollow">Page source</a></li>
    </div>

    

    
  </body>
</html>
